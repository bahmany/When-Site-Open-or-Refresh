<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="530px" preserveAspectRatio="none" style="width:740px;height:530px;background:#FFFFFF;" version="1.1" viewBox="0 0 740 530" width="740px" zoomAndPan="magnify"><defs/><g><rect height="27.6094" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="202" x="267.75" y="15"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="192" x="272.75" y="34.5332">When Site Open or Refresh</text><ellipse cx="230.4375" cy="58.6094" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="85" x="187.9375" y="88.6094"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="65" x="197.9375" y="111.0664">site request</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="178" x="141.4375" y="143.7031"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="158" x="151.4375" y="166.1602">get csrf token for all requests</text><polygon fill="#F1F1F1" points="183.9375,198.7969,276.9375,198.7969,288.9375,210.7969,276.9375,222.7969,183.9375,222.7969,171.9375,210.7969,183.9375,198.7969" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="93" x="183.9375" y="215.2979">check auth cookies</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="46" x="125.9375" y="208.3799">not found</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="28" x="288.9375" y="208.3799">found</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="133" x="11" y="232.7969"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="113" x="21" y="255.2539">mark as anonymous</text><ellipse cx="77.5" cy="312.8906" rx="10" ry="10" style="stroke:#222222;stroke-width:1.5;fill:none;"/><line style="stroke:#222222;stroke-width:2.5;fill:none;" x1="71.3128" x2="83.6872" y1="306.7034" y2="319.0778"/><line style="stroke:#222222;stroke-width:2.5;fill:none;" x1="83.6872" x2="71.3128" y1="306.7034" y2="319.0778"/><polygon fill="#F1F1F1" points="347.875,232.7969,418.875,232.7969,430.875,244.7969,418.875,256.7969,347.875,256.7969,335.875,244.7969,347.875,232.7969" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="71" x="347.875" y="249.2979">token available</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="317.875" y="242.3799">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="12" x="430.875" y="242.3799">no</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="95" x="174" y="266.7969"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="72" x="184" y="289.2539">mark as auth</text><ellipse cx="221.5" cy="346.8906" rx="10" ry="10" style="stroke:#222222;stroke-width:1.5;fill:none;"/><line style="stroke:#222222;stroke-width:2.5;fill:none;" x1="215.3128" x2="227.6872" y1="340.7034" y2="353.0778"/><line style="stroke:#222222;stroke-width:2.5;fill:none;" x1="227.6872" x2="215.3128" y1="340.7034" y2="353.0778"/><polygon fill="#F1F1F1" points="508.25,266.7969,582.25,266.7969,594.25,278.7969,582.25,290.7969,508.25,290.7969,496.25,278.7969,508.25,266.7969" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="74" x="508.25" y="283.2979">refresh token ?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="478.25" y="276.3799">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="12" x="594.25" y="276.3799">no</text><polygon fill="#F1F1F1" points="377,300.7969,478,300.7969,490,312.7969,478,324.7969,377,324.7969,365,312.7969,377,300.7969" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="101" x="377" y="317.2979">refresh token is valid</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="347" y="310.3799">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="12" x="490" y="310.3799">no</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="92" x="309" y="334.7969"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="72" x="319" y="357.2539">mark as auth</text><ellipse cx="355" cy="414.8906" rx="10" ry="10" style="stroke:#222222;stroke-width:1.5;fill:none;"/><line style="stroke:#222222;stroke-width:2.5;fill:none;" x1="348.8128" x2="361.1872" y1="408.7034" y2="421.0778"/><line style="stroke:#222222;stroke-width:2.5;fill:none;" x1="361.1872" x2="348.8128" y1="408.7034" y2="421.0778"/><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="133" x="433.5" y="334.7969"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="113" x="443.5" y="357.2539">mark as anonymous</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="124" x="365.5" y="444.8906"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="104" x="375.5" y="467.3477">gettting main token</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="133" x="596.5" y="300.7969"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="113" x="606.5" y="323.2539">mark as anonymous</text><ellipse cx="663" cy="380.8906" rx="10" ry="10" style="stroke:#222222;stroke-width:1.5;fill:none;"/><line style="stroke:#222222;stroke-width:2.5;fill:none;" x1="656.8128" x2="669.1872" y1="374.7034" y2="387.0778"/><line style="stroke:#222222;stroke-width:2.5;fill:none;" x1="669.1872" x2="656.8128" y1="374.7034" y2="387.0778"/><ellipse cx="383.375" cy="509.9844" rx="10" ry="10" style="stroke:#222222;stroke-width:1.5;fill:none;"/><line style="stroke:#222222;stroke-width:2.5;fill:none;" x1="377.1878" x2="389.5622" y1="503.7972" y2="516.1716"/><line style="stroke:#222222;stroke-width:2.5;fill:none;" x1="389.5622" x2="377.1878" y1="503.7972" y2="516.1716"/><line style="stroke:#181818;stroke-width:1.0;fill:none;" x1="230.4375" x2="230.4375" y1="68.6094" y2="88.6094"/><polygon fill="#181818" points="226.4375,78.6094,230.4375,88.6094,234.4375,78.6094,230.4375,82.6094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="230.4375" x2="230.4375" y1="123.7031" y2="143.7031"/><polygon fill="#181818" points="226.4375,133.7031,230.4375,143.7031,234.4375,133.7031,230.4375,137.7031" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="77.5" x2="77.5" y1="267.8906" y2="302.8906"/><polygon fill="#181818" points="73.5,292.8906,77.5,302.8906,81.5,292.8906,77.5,296.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="221.5" x2="221.5" y1="301.8906" y2="336.8906"/><polygon fill="#181818" points="217.5,326.8906,221.5,336.8906,225.5,326.8906,221.5,330.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="355" x2="355" y1="369.8906" y2="404.8906"/><polygon fill="#181818" points="351,394.8906,355,404.8906,359,394.8906,355,398.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="365" x2="355" y1="312.7969" y2="312.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="355" x2="355" y1="312.7969" y2="334.7969"/><polygon fill="#181818" points="351,324.7969,355,334.7969,359,324.7969,355,328.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="490" x2="500" y1="312.7969" y2="312.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="500" x2="500" y1="312.7969" y2="334.7969"/><polygon fill="#181818" points="496,324.7969,500,334.7969,504,324.7969,500,328.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="500" x2="500" y1="369.8906" y2="429.8906"/><line style="stroke:#181818;stroke-width:1.0;" x1="500" x2="427.5" y1="429.8906" y2="429.8906"/><line style="stroke:#181818;stroke-width:1.0;" x1="427.5" x2="427.5" y1="429.8906" y2="444.8906"/><polygon fill="#181818" points="423.5,434.8906,427.5,444.8906,431.5,434.8906,427.5,438.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="663" x2="663" y1="335.8906" y2="370.8906"/><polygon fill="#181818" points="659,360.8906,663,370.8906,667,360.8906,663,364.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="496.25" x2="427.5" y1="278.7969" y2="278.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="427.5" x2="427.5" y1="278.7969" y2="300.7969"/><polygon fill="#181818" points="423.5,290.7969,427.5,300.7969,431.5,290.7969,427.5,294.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="594.25" x2="663" y1="278.7969" y2="278.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="663" x2="663" y1="278.7969" y2="300.7969"/><polygon fill="#181818" points="659,290.7969,663,300.7969,667,290.7969,663,294.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="427.5" x2="427.5" y1="479.9844" y2="484.9844"/><line style="stroke:#181818;stroke-width:1.0;" x1="427.5" x2="383.375" y1="484.9844" y2="484.9844"/><line style="stroke:#181818;stroke-width:1.0;" x1="383.375" x2="383.375" y1="484.9844" y2="499.9844"/><polygon fill="#181818" points="379.375,489.9844,383.375,499.9844,387.375,489.9844,383.375,493.9844" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="335.875" x2="221.5" y1="244.7969" y2="244.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="221.5" x2="221.5" y1="244.7969" y2="266.7969"/><polygon fill="#181818" points="217.5,256.7969,221.5,266.7969,225.5,256.7969,221.5,260.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="430.875" x2="545.25" y1="244.7969" y2="244.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="545.25" x2="545.25" y1="244.7969" y2="266.7969"/><polygon fill="#181818" points="541.25,256.7969,545.25,266.7969,549.25,256.7969,545.25,260.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="171.9375" x2="77.5" y1="210.7969" y2="210.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="77.5" x2="77.5" y1="210.7969" y2="232.7969"/><polygon fill="#181818" points="73.5,222.7969,77.5,232.7969,81.5,222.7969,77.5,226.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="288.9375" x2="383.375" y1="210.7969" y2="210.7969"/><line style="stroke:#181818;stroke-width:1.0;" x1="383.375" x2="383.375" y1="210.7969" y2="232.7969"/><polygon fill="#181818" points="379.375,222.7969,383.375,232.7969,387.375,222.7969,383.375,226.7969" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="230.4375" x2="230.4375" y1="178.7969" y2="198.7969"/><polygon fill="#181818" points="226.4375,188.7969,230.4375,198.7969,234.4375,188.7969,230.4375,192.7969" style="stroke:#181818;stroke-width:1.0;"/><!--MD5=[b91d71c873ba25c3fef425ce1aaef7d7]
@startuml

title  When Site Open or Refresh

start
:site request;
:get csrf token for all requests;
if (check auth cookies) then (not found)
:mark as anonymous;
end
else (found)
if (token available) then (yes)
:mark as auth ;
end
else (no)
if (refresh token ?) then (yes)

        if (refresh token is valid) then (yes)
            :mark as auth;
            end
        else (no)
        :mark as anonymous;
        endif

    :gettting main token;
    else (no)
    :mark as anonymous;
    end
endif
endif
end




@enduml

PlantUML version 1.2022.5(Sat Apr 30 15:25:52 IRDT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1256
Language: en
Country: US
--></g></svg>